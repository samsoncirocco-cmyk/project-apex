# TATT Architect - AI/Notion Integration
# Node.js 22 LTS with Notion SDK and Ollama client

FROM node:22-slim

LABEL maintainer="Project Apex"
LABEL description="AI orchestration and Notion integration for Project Apex"

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    sqlite3 \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Create non-root user
RUN useradd -m -u 1000 appuser

# Copy package.json if exists, otherwise create placeholder
COPY bots/tatt-architect/package*.json ./ 2>/dev/null || echo '{"name":"tatt-architect","version":"1.0.0","type":"module","dependencies":{"@notionhq/client":"^2.2.0","ollama":"^0.5.0","better-sqlite3":"^11.0.0","redis":"^4.6.0","dotenv":"^16.4.0"}}' > package.json

# Install dependencies
RUN npm install --omit=dev

# Copy application code (will be empty initially)
COPY bots/tatt-architect/ . 2>/dev/null || true

# Create necessary directories
RUN mkdir -p /data /config && chown -R appuser:appuser /app /data /config

# Switch to non-root user
USER appuser

# Default command (placeholder - actual entrypoint will be set with bot code)
CMD ["node", "-e", "console.log('TATT Architect waiting for code...'); setInterval(() => {}, 86400000)"]
